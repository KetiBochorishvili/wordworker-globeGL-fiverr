<head>
    <style>
        body {
            margin: 0;
        }
    </style>

    <script src="//unpkg.com/globe.gl"></script>
</head>

<body>
    <div id="globeViz"></div>
    <script src="libs/d3.v7.min.js"></script>

    <script>
        // Gen random data

        d3.csv('data/dataset.csv')
            .then(data => {
                console.log(data)

                data.forEach((d, i) => {
                    if (d.Lat.includes('° N'))
                        d.lat = +d.Lat.replace('° N', '');
                    else if (d.Lat.includes('° S'))
                        d.lat = -d.Lat.replace('° S', '');

                    if (d.Long.includes('° E'))
                        d.lng = +d.Long.replace('° E', '');
                    else if (d.Long.includes('° W'))
                        d.lng = - d.Long.replace('° W', '');

                    d.size = 0.15;
                    if (d.Type === 'Data Center')
                        d.color = '#A020F0'
                    else if (d.Type === 'Network PoP')
                        d.color = '#E5B80B'

                })

                const N = 300;
                const gData = [...Array(N).keys()].map(() => ({
                    lat: (Math.random() - 0.5) * 180,
                    lng: (Math.random() - 0.5) * 360,
                    size: Math.random() / 3,
                    color: ['red', 'white', 'blue', 'green'][Math.round(Math.random() * 3)]
                }));
                console.log(gData)
                const world = Globe()
                    .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
                    .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
                    .pointsData(data)
                    .pointAltitude('size')
                    .pointColor('color')
                    .onGlobeClick(() => world.controls().autoRotate = false)

                    (document.getElementById('globeViz'))

                world.controls().autoRotate = true;
                world.controls().autoRotateSpeed = 0.6;
            })

    </script>
</body>